---
title: "wikipida"
author: "Aswin Kithalawaarachchi"
date: "2023-09-20"
output: html_document
---

```{r}
# Load necessary libraries
library(dplyr)
library(readr)
library(tidyverse)
library(urca)
library(fpp3)
```
```{r}
# Load the datasets
wiki_df <- read_csv('wikipedia.csv', col_names=FALSE)
train_df <- read_csv('filtered_train_2.csv')

# Extract the first time series from both datasets
wiki_series <- as.numeric(wiki_df[2, -1])
train_series <- as.numeric(train_df[2, -1])

# Normalize the series
wiki_series <- scale(wiki_series)
train_series <- scale(train_series)

# Initialize variables to store maximum correlation and its corresponding lag
max_corr <- -1
max_lag <- 0

# Loop over possible lags and calculate correlation for each lag
for (lag in 0:(min(length(wiki_series), length(train_series)) - 1)) {
  wiki_subseries <- wiki_series[(lag + 1):(min(length(wiki_series), length(train_series) + lag))]
  train_subseries <- train_series[1:(min(length(wiki_series) - lag, length(train_series)))]
  
  # Ensure the lengths of the series are equal before calculating the correlation
  if(length(wiki_subseries) == length(train_subseries)) {
    # Calculate correlation for the current lag
    current_corr <- cor(wiki_subseries, train_subseries)
    
    # Update maximum correlation and its corresponding lag if the current correlation is greater
    if (current_corr > max_corr) {
      max_corr <- current_corr
      max_lag <- lag
    }
  }
}

# Calculate the start date for the Wikipedia series based on the optimal lag
start_date <- as.Date(names(train_df)[2]) + max_lag

# Generate the date range for the Wikipedia series
wiki_dates <- seq(start_date, by='day', length.out=ncol(wiki_df) - 1)  # Correcting the length of the date sequence

# Create a new DataFrame for the Wikipedia dataset with the estimated dates as columns
wiki_df_with_dates <- as.data.frame(cbind(Page=wiki_df$X1, as.data.frame(matrix(unlist(wiki_df[-1]), nrow=nrow(wiki_df), byrow=T))))

# Assign the generated dates as column names
colnames(wiki_df_with_dates)[-1] <- as.character(wiki_dates)

# View the resulting DataFrame
head(wiki_df_with_dates)

```





```{r get the country/device}
country_class <- function (name) {
  name_and_country_code <- str_split(name, "[.]")[1]
  thingies <- str_split(name_and_country_code, "_")
  token_len <- len(thingies)
  
  return (thingies[token_len])
}

device_class <- function (name) {
  device_code <- str_split(name, "[.]")[2]
  
  return (device_code)
}
```








